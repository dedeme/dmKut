// Copyright 09-Jan-2023 ÂºDeme
// GNU General Public License - V3 <http://www.gnu.org/licenses/>

import "data/cts";

fail = \err -> {
    sys.println(err);
    sys.exit(1);
};

/// \->()
run = \-> {
  ConErr = tcp.dial("localhost:34656", 1000);
  err = ConErr[1];
  if (err != "") fail("dial: " + err);
  rq = {
    "type": js.ws(cts.rqTypes.start)
  };
  con = ConErr[0];
  Rs = tcp.write(con, js.wo(rq));
  if (!arr.empty(Rs)) fail("start-w: " + Rs!);
  RpErr = tcp.read(con, 1000);
  err2 = RpErr[1];
  if (err2 != "") fail("start-r: " + err2);
  rp = RpErr[0];
  sys.println(rp);
};
